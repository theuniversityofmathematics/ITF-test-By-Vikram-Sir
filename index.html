<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Online MCQ Test</title>
<style>
  body { font-family: Arial, sans-serif; background: #fffbe6; margin: 0; padding: 0; }
  .wrap { max-width: 900px; margin: auto; padding: 20px; }
  h1 { margin-bottom: 5px; text-align: center; }
  fieldset { border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; border-radius: 8px; background: #fff; }
  legend { font-weight: bold; }
  .option { display: block; margin-bottom: 5px; }
  .controls { margin-top: 15px; text-align: center; }
  button { padding: 8px 12px; margin: 5px; border: none; border-radius: 6px; cursor: pointer; background: #f0c040; }
  #resultCard { margin-top: 20px; background: #fff; padding: 15px; border-radius: 10px; border: 2px solid #ccc; max-width: 500px; margin-left: auto; margin-right: auto; text-align: center; }
  #timer { font-size: 20px; font-weight: bold; color: red; text-align: center; margin-bottom: 10px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  table, th, td { border: 1px solid #ccc; }
  th, td { padding: 8px; text-align: left; }
</style>
</head>
<body>
<div class="wrap">
  <h1>The University Of Mathematics (Maths by Vikram Sir)</h1>

  <!-- Password Screen -->
  <div id="passwordScreen">
    <fieldset>
      <legend>Enter Password</legend>
      <input type="password" id="accessPassword" placeholder="Enter password">
      <button onclick="checkPassword()">Enter</button>
    </fieldset>
  </div>

  <!-- Name Input -->
  <div id="nameScreen" style="display:none;">
    <fieldset>
      <legend>Enter Your Name</legend>
      <input type="text" id="studentName" placeholder="Your Name" required>
      <button onclick="startTest()">Start Test</button>
    </fieldset>
  </div>

  <!-- Quiz Container -->
  <div id="quizContainer" style="display:none;">
    <div id="timer"></div>
    <form id="quiz"></form>
    <div class="controls">
      <button type="button" id="nextBtn" onclick="nextQuestion()">Next</button>
    </div>
    <div id="resultCard" style="display:none;">
      <h2>Test Result</h2>
      <p id="studentDetails"></p>
      <p id="scoreDetails"></p>
      <div id="summary"></div>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel" style="display:none;">
    <h2>All Student Results</h2>
    <table id="resultsTable">
      <thead>
        <tr><th>Name</th><th>Score</th><th>Date</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="downloadCSV()">Download CSV</button>
  </div>
</div>

<script>
const inverseTrigQuestions = [
  {q: 'Principal value of sin⁻¹(√3/2) is:', options: ['π/3','2π/3','π/6','−π/3'], ans: 'a'},
  {q: 'Principal value of cos⁻¹(1/2) is:', options: ['π/3','2π/3','π/6','−π/3'], ans: 'a'},
  {q: 'Principal value of tan⁻¹(1) is:', options: ['π/4','3π/4','−π/4','π/2'], ans: 'a'},
  {q: 'Principal value of cot⁻¹(1) is:', options: ['π/4','3π/4','π/2','−π/4'], ans: 'a'},
  {q: 'Principal value of sec⁻¹(2) is:', options: ['π/3','2π/3','π/6','−π/3'], ans: 'a'},
  {q: 'Principal value of csc⁻¹(2) is:', options: ['π/6','5π/6','π/3','−π/6'], ans: 'a'},
  {q: 'Principal value of sin⁻¹(−1/2) is:', options: ['−π/6','π/6','5π/6','−5π/6'], ans: 'a'},
  {q: 'Principal value of cos⁻¹(−1/2) is:', options: ['2π/3','4π/3','π/3','−π/3'], ans: 'a'},
  {q: 'Principal value of tan⁻¹(−1) is:', options: ['−π/4','3π/4','π/4','−3π/4'], ans: 'a'},
  {q: 'Principal value of sin⁻¹(0) is:', options: ['0','π/2','π','−π/2'], ans: 'a'},
  {q: 'Principal value of cos⁻¹(0) is:', options: ['π/2','0','π','−π/2'], ans: 'a'},
  {q: 'Principal value of tan⁻¹(√3) is:', options: ['π/3','π/6','2π/3','−π/3'], ans: 'a'},
  {q: 'Principal value of cot⁻¹(√3) is:', options: ['π/6','π/3','5π/6','−π/6'], ans: 'a'},
  {q: 'Principal value of sec⁻¹(−2) is:', options: ['2π/3','−π/3','π/3','−2π/3'], ans: 'a'},
  {q: 'Principal value of csc⁻¹(−2) is:', options: ['−π/6','π/6','5π/6','−5π/6'], ans: 'a'},
  {q: 'Principal value of sin⁻¹(1) is:', options: ['π/2','−π/2','0','π'], ans: 'a'},
  {q: 'Principal value of cos⁻¹(1) is:', options: ['0','π','π/2','−π/2'], ans: 'a'},
  {q: 'Principal value of tan⁻¹(0) is:', options: ['0','π/2','π','−π/2'], ans: 'a'},
  {q: 'Principal value of cot⁻¹(0) is:', options: ['π/2','0','π','−π/2'], ans: 'a'},
  {q: 'Principal value of sin⁻¹(−1) is:', options: ['−π/2','π/2','0','−π'], ans: 'a'}
];

const straightLineQuestions = [
  {q: 'The slope of the line 2x + 3y = 6 is:', options: ['-2/3','2/3','3/2','-3/2'], ans: 'a'},
  {q: 'The equation of x-axis is:', options: ['y=0','x=0','y=1','x=1'], ans: 'a'},
  {q: 'The slope of a vertical line is:', options: ['0','1','undefined','infinite'], ans: 'c'},
  {q: 'The equation of y-axis is:', options: ['x=0','y=0','x=1','y=1'], ans: 'a'},
  {q: 'If a line is parallel to y-axis, its slope is:', options: ['0','undefined','1','-1'], ans: 'b'},
  {q: 'The slope of line y=3x+2 is:', options: ['3','2','-3','1/3'], ans: 'a'},
  {q: 'Two lines are perpendicular if product of slopes is:', options: ['-1','1','0','infinite'], ans: 'a'},
  {q: 'The distance between points (0,0) and (3,4) is:', options: ['5','4','3','7'], ans: 'a'},
  {q: 'The midpoint of (2,3) and (4,7) is:', options: ['(3,5)','(2,5)','(4,3)','(5,7)'], ans: 'a'},
  {q: 'Slope of line through (1,2) and (3,6) is:', options: ['2','3','4','1'], ans: 'a'},
  {q: 'Equation of line with slope 2 passing through (0,0) is:', options: ['y=2x','y=2x+1','y=x+2','y=-2x'], ans: 'a'},
  {q: 'Equation of line passing through (1,1) with slope -1 is:', options: ['y=-x+2','y=x+2','y=-x-1','y=x-1'], ans: 'a'},
  {q: 'If a line passes through (0,5) and is parallel to x-axis:', options: ['y=5','x=5','y=0','x=0'], ans: 'a'},
  {q: 'Slope of line y = -3x + 4 is:', options: ['-3','3','4','-4'], ans: 'a'},
  {q: 'If a line is perpendicular to x-axis:', options: ['Slope undefined','Slope 0','Slope 1','Slope -1'], ans: 'a'},
  {q: 'The general equation of straight line is:', options: ['ax+by+c=0','y=mx+c','x=a','y=b'], ans: 'a'},
  {q: 'If slope m=1, then line makes 45° with:', options: ['x-axis','y-axis','both','none'], ans: 'a'},
  {q: 'Length of line between (2,3) and (2,8) is:', options: ['5','6','8','4'], ans: 'a'},
  {q: 'Slope of horizontal line is:', options: ['0','1','infinite','undefined'], ans: 'a'},
  {q: 'Equation of line parallel to y-axis at x=3 is:', options: ['x=3','y=3','x=0','y=0'], ans: 'a'}
];

let currentQuestions = [];
let shuffledQuestions = [];
let currentQuestionIndex = 0;
let answers = [];
let timerInterval;
let timeLeft = 30;
let currentTest = "";

function shuffleArray(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function checkPassword(){
  const pass = document.getElementById('accessPassword').value.trim();
  if(pass === "200"){ currentTest = "Inverse Trig"; currentQuestions = inverseTrigQuestions; document.getElementById('passwordScreen').style.display='none'; document.getElementById('nameScreen').style.display='block'; }
  else if(pass === "100"){ currentTest = "Straight Line"; currentQuestions = straightLineQuestions; document.getElementById('passwordScreen').style.display='none'; document.getElementById('nameScreen').style.display='block'; }
  else if(pass === "9110"){ showAdmin(); }
  else { alert("Wrong password!"); }
}

function startTest(){
  const name = document.getElementById('studentName').value.trim();
  if(!name){ alert("Please enter your name"); return; }
  document.getElementById('nameScreen').style.display = 'none';
  document.getElementById('quizContainer').style.display = 'block';
  shuffledQuestions = shuffleArray([...currentQuestions]);
  currentQuestionIndex = 0;
  answers = Array(shuffledQuestions.length).fill(null);
  showQuestion();
}

function showQuestion(){
  clearInterval(timerInterval);
  timeLeft = 30;
  document.getElementById('timer').textContent = `Time Left: ${timeLeft}s`;
  timerInterval = setInterval(()=>{
    timeLeft--;
    document.getElementById('timer').textContent = `Time Left: ${timeLeft}s`;
    if(timeLeft <= 0){ clearInterval(timerInterval); nextQuestion(); }
  },1000);

  const quiz = document.getElementById('quiz');
  quiz.innerHTML = '';
  const qObj = shuffledQuestions[currentQuestionIndex];
  const shuffledOptions = shuffleArray([...qObj.options]);
  let html = `<fieldset><legend>Q${currentQuestionIndex+1}) ${qObj.q}</legend>`;
  shuffledOptions.forEach((opt, i) => {
    const optLetter = String.fromCharCode(97 + i);
    html += `<label class='option'><input type='radio' name='q' value='${optLetter}'> (${optLetter}) ${opt}</label>`;
  });
  html += '</fieldset>';
  quiz.innerHTML = html;
  document.getElementById('nextBtn').textContent = currentQuestionIndex === shuffledQuestions.length - 1 ? 'Submit' : 'Next';
}

function nextQuestion(){
  const sel = document.querySelector("input[name='q']:checked");
  if(sel){ answers[currentQuestionIndex] = sel.value; }
  if(currentQuestionIndex === shuffledQuestions.length - 1){ submitQuiz(); return; }
  currentQuestionIndex++;
  showQuestion();
}

function submitQuiz(){
  clearInterval(timerInterval);
  let score = 0;
  let summaryHTML = "<h3>Answer Summary:</h3><ol>";
  shuffledQuestions.forEach((item, idx) => {
    const correctOpt = item.ans;
    const correctAnsText = item.options[correctOpt.charCodeAt(0)-97];
    let userAns = answers[idx] ? item.options[answers[idx].charCodeAt(0)-97] : "Not Attempted";
    if(answers[idx] === correctOpt) score++;
    summaryHTML += `<li>${item.q}<br>Your Ans: ${userAns} | Correct: ${correctAnsText}</li>`;
  });
  summaryHTML += "</ol>";

  document.getElementById('quiz').style.display = 'none';
  document.getElementById('nextBtn').style.display = 'none';
  document.getElementById('timer').style.display = 'none';
  document.getElementById('resultCard').style.display = 'block';
  document.getElementById('studentDetails').textContent = `Name: ${document.getElementById('studentName').value.trim()} | Test: ${currentTest}`;
  document.getElementById('scoreDetails').textContent = `Score: ${score} / ${shuffledQuestions.length}`;
  document.getElementById('summary').innerHTML = summaryHTML;

  saveResult(document.getElementById('studentName').value.trim(), score);
}

function saveResult(name, score){
  let results = JSON.parse(localStorage.getItem("quizResults") || "[]");
  results.push({name: name, score: score, date: new Date().toLocaleString()});
  localStorage.setItem("quizResults", JSON.stringify(results));
}

function showAdmin(){
  document.getElementById('passwordScreen').style.display = 'none';
  document.getElementById('adminPanel').style.display = 'block';
  let results = JSON.parse(localStorage.getItem("quizResults") || "[]");
  const tbody = document.querySelector("#resultsTable tbody");
  tbody.innerHTML = "";
  results.forEach(r=>{
    tbody.innerHTML += `<tr><td>${r.name}</td><td>${r.score}</td><td>${r.date}</td></tr>`;
  });
}

function downloadCSV(){
  let results = JSON.parse(localStorage.getItem("quizResults") || "[]");
  let csv = "Name,Score,Date\n";
  results.forEach(r=>{ csv += `${r.name},${r.score},${r.date}\n`; });
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "results.csv";
  a.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
