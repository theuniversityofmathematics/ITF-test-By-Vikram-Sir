<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Combined Quizzes — The University Of Mathematics</title>
<style>
  body { font-family: Arial, sans-serif; background:#fffbe6; margin:0; padding:18px; }
  .wrap { max-width:1000px; margin:0 auto; }
  h1 { text-align:center; margin-bottom:6px; }
  fieldset { background:#fff; border:1px solid #ccc; padding:12px; border-radius:8px; margin-bottom:12px; }
  legend { font-weight:700; }
  input[type=text], input[type=password] { padding:8px; width:60%; max-width:360px; }
  button { padding:8px 12px; margin-left:6px; background:#f0c040; border:none; border-radius:6px; cursor:pointer; }
  #timer { font-size:18px; color:#b71c1c; font-weight:700; text-align:center; margin-bottom:8px; }
  .option { display:block; margin:8px 0; }
  #resultCard { background:#fff; border:2px solid #ccc; padding:12px; border-radius:8px; margin-top:12px; }
  .answer-summary { font-family:monospace; white-space:pre-wrap; text-align:left; margin-top:10px; }
  table { width:100%; border-collapse:collapse; margin-top:12px; background:#fff; }
  th, td { border:1px solid #aaa; padding:8px; text-align:center; }
  .controls { text-align:center; margin-top:10px; }
  .small { font-size:13px; color:#444; }
  a.link-button { display:inline-block; padding:8px 12px; background:#7fb3ff; color:#000; border-radius:6px; text-decoration:none; margin-left:6px; }
</style>
</head>
<body>
<div class="wrap">
  <h1>The University Of Mathematics (Maths by Vikram Sir)</h1>

  <!-- Password screen -->
  <div id="passwordScreen">
    <fieldset>
      <legend>Access</legend>
      <input id="accessPwd" type="password" placeholder="Enter password">
      <button onclick="onPasswordEnter()">Enter</button>
    </fieldset>
  </div>

  <!-- Name input -->
  <div id="nameScreen" style="display:none;">
    <fieldset>
      <legend>Student Details</legend>
      <label class="small">Name: <input id="studentName" type="text" placeholder="Enter your name"></label>
      <button onclick="startQuiz()">Start Test</button>
    </fieldset>
  </div>

  <!-- Quiz -->
  <div id="quizScreen" style="display:none;">
    <div id="timer"></div>
    <div id="questionBox"></div>
    <div class="controls">
      <button id="nextBtn" onclick="onNext()">Next</button>
    </div>
    <div id="resultCard" style="display:none;">
      <h2>Test Result</h2>
      <p id="studentInfo" class="small"></p>
      <p id="scoreInfo" class="small"></p>
      <div id="summary" class="answer-summary"></div>
      <div class="controls">
        <button onclick="printResult()">Print Result</button>
      </div>
    </div>
  </div>

  <!-- Admin -->
  <div id="adminScreen" style="display:none;">
    <fieldset>
      <legend>Admin — Stored Results (local)</legend>
      <table>
        <thead><tr><th>Name</th><th>Quiz</th><th>Score</th><th>Date</th></tr></thead>
        <tbody id="adminTable"></tbody>
      </table>
      <div class="controls" style="margin-top:10px;">
        <button onclick="downloadLocalCSV()">Download Local CSV</button>
        <button onclick="clearLocalResults()">Clear Local Results</button>
        <a id="openSheetBtn" class="link-button" target="_blank" href="#">Open Google Sheet</a>
      </div>
    </fieldset>
  </div>
</div>

<script>
// ====== CONFIG ======
const SERVER_WEBAPP_URL = "https://script.google.com/macros/s/AKfycby0TOM4NqTTIJnLi_kh1gPY6VStck66t4MpLYLqM5XcyGe_n7ZwCDr7jxScDC4eoh2-/exec";
const GOOGLE_SHEET_URL = "https://docs.google.com/spreadsheets/d/1q073kqP1dLG2Lqbyu4dBNwtYCzq61mVHsl5B37npT6Y/edit?usp=sharing";

// Sets quiz time window (IST/local): August 15, 2025, 7:45 PM to 8:00 PM
const SETS_START = new Date("2025-08-15T19:45:00");
const SETS_END   = new Date("2025-08-15T20:00:00");

// ====== QUESTION BANK ======
const BANK = {
  // NEW: Sets (password 150)
  "150": { title:"Sets (Class 11)", questions:[
    {q:"If A={1,2,3} and B={2,3,4}, A∩B=?", options:["{2,3}","{1,4}","{1,2}","{3,4}"], ans:"a"},
    {q:"If A={1,2}, B={2,3}, A∪B=?", options:["{1,2,3}","{2}","{1,3}","{1,2}"], ans:"a"},
    {q:"n(∅) =", options:["0","1","∞","Not defined"], ans:"a"},
    {q:"If U={1,2,3,4,5}, A={2,3}, A'?", options:["{1,4,5}","{2,3}","{3,4,5}","{1,2}"], ans:"a"},
    {q:"Set with one element is called?", options:["Singleton","Null","Finite","Infinite"], ans:"a"},
    {q:"If A={1,2}, B={2,3}, A−B=?", options:["{1}","{2}","{3}","∅"], ans:"a"},
    {q:"n({a,e,i,o,u}) =", options:["5","4","3","2"], ans:"a"},
    {q:"If A⊆B and B⊆A, then A and B are?", options:["Equal","Disjoint","Null","Finite"], ans:"a"},
    {q:"If A={1,2}, P(A) has how many elements?", options:["4","2","3","1"], ans:"a"},
    {q:"If n(A)=3, then n(P(A)) =", options:["8","6","3","9"], ans:"a"},
    {q:"If A∩B=∅, then A and B are?", options:["Disjoint","Equal","Finite","Infinite"], ans:"a"},
    {q:"n({∅}) =", options:["1","0","2","∞"], ans:"a"},
    {q:"{x: x is even natural ≤10} =", options:["{2,4,6,8,10}","{1,3,5,7,9}","{0,2,4}","{2,4}"], ans:"a"},
    {q:"If A={1,2,3}, n(A×A) =", options:["9","6","3","8"], ans:"a"},
    {q:"If A={1}, B={1,2}, then A⊆B?", options:["True","False","Not defined","Can't say"], ans:"a"},
    {q:"n(∅) =", options:["0","n(A)","1","∞"], ans:"c"},
    {q:"If A={1,2}, B={3,4}, then A∩B=?", options:["∅","{1,3}","{2,4}","{1,4}"], ans:"a"},
    {q:"Universal set means?", options:["Set containing all objects","Set with 1 element","Null set","Subset"], ans:"a"},
    {q:"If A={a,b}, then P(A) =", options:["{∅,{a},{b},{a,b}}","{a,b}","∅","{a}"], ans:"a"},
    {q:"n({{1,2}}) =", options:["1","2","3","0"], ans:"a"}
  ]},

  // Straight Line (password 100) — SAME as your file
  "100": { title:"Straight Line (Class 11)", questions:[
    {q:"Slope of 2x-3y+5=0?", options:["2/3","3/2","-2/3","-3/2"], ans:"c"},
    {q:"Equation of x-axis?", options:["x=0","y=0","y=x","x+y=0"], ans:"b"},
    {q:"Line through (0,0)&(2,3) slope?", options:["3/2","2/3","-3/2","-2/3"], ans:"a"},
    {q:"Slope perpendicular to y=-2x+5?", options:["1/2","2","-1/2","-2"], ans:"a"},
    {q:"Point (a,0) lies on?", options:["x-axis","y-axis","y=x","y=-x"], ans:"a"},
    {q:"Distance (3,4) to (0,0)?", options:["5","7","4","3"], ans:"a"},
    {q:"Equation y-2=0 represents?", options:["x-axis","y-axis","Horizontal","Vertical"], ans:"c"},
    {q:"Line with slope m through (x1,y1)?", options:["y-y1=m(x-x1)","y=mx+c","x/x1 + y/y1=1","None"], ans:"a"},
    {q:"Slope of vertical line?", options:["0","∞","1","-1"], ans:"b"},
    {q:"Intercepts of 3x+2y=6?", options:["(2,0)&(0,3)","(0,2)&(3,0)","(0,3)&(2,0)","(0,0)&(3,2)"], ans:"c"},
    {q:"Midpoint of (1,2)&(3,4)?", options:["(2,3)","(1,1)","(2,2)","(3,2)"], ans:"a"},
    {q:"Line through (1,2) slope 3?", options:["y=3x-1","y=3x+2","y=2x+3","y=-3x+5"], ans:"b"},
    {q:"Line parallel y=2x+5 slope?", options:["2","1/2","-2","-1/2"], ans:"a"},
    {q:"Line perpendicular y=5x+1 passes (0,1)?", options:["y=-1/5 x+1","y=5x+1","y=-5x+1","y=1/5x+1"], ans:"a"},
    {q:"Distance (1,1) to line x+y-3=0?", options:["1","√2","3","2"], ans:"b"},
    {q:"Equation bisector of x & y axes?", options:["y=x","y=-x","x+y=1","x-y=0"], ans:"a"},
    {q:"Line with intercepts (2,0)&(0,3) equation?", options:["x/2+y/3=1","y=2x+3","x+y=5","y=-2x+3"], ans:"a"},
    {q:"Distance between y=2x+1 & y=2x-3?", options:["2","3","4","5"], ans:"b"},
    {q:"Slope-intercept 3x-4y+12=0?", options:["3/4","-3/4","4/3","-4/3"], ans:"b"},
    {q:"y=mx+c through (2,3)&(4,7) m?", options:["1","2","3","4"], ans:"b"}
  ]},

  // Inverse Trigonometry (password 200) — SAME as your file
  "200": { title:"Inverse Trigonometry (Class 12)", questions:[
    {q:"Principal value sin⁻¹(√3/2)?", options:["π/3","2π/3","π/6","-π/3"], ans:"a"},
    {q:"Principal value cos⁻¹(1/2)?", options:["π/3","2π/3","π/6","-π/3"], ans:"a"},
    {q:"Principal value tan⁻¹(1)?", options:["π/4","3π/4","-π/4","π/2"], ans:"a"},
    {q:"Principal value cot⁻¹(1)?", options:["π/4","3π/4","π/2","-π/4"], ans:"a"},
    {q:"Principal value sec⁻¹(2)?", options:["π/3","2π/3","π/6","-π/3"], ans:"a"},
    {q:"Principal value csc⁻¹(2)?", options:["π/6","5π/6","π/3","-π/6"], ans:"a"},
    {q:"Principal value sin⁻¹(-1/2)?", options:["-π/6","π/6","5π/6","-5π/6"], ans:"a"},
    {q:"Principal value cos⁻¹(-1/2)?", options:["2π/3","4π/3","π/3","-π/3"], ans:"a"},
    {q:"Principal value tan⁻¹(-1)?", options:["-π/4","3π/4","π/4","-3π/4"], ans:"a"},
    {q:"Principal value sin⁻¹(0)?", options:["0","π/2","π","-π/2"], ans:"a"},
    {q:"Principal value cos⁻¹(0)?", options:["π/2","0","π","-π/2"], ans:"a"},
    {q:"Principal value tan⁻¹(√3)?", options:["π/3","π/6","2π/3","-π/3"], ans:"a"},
    {q:"Principal value cot⁻¹(√3)?", options:["π/6","π/3","5π/6","-π/6"], ans:"a"},
    {q:"Principal value sec⁻¹(-2)?", options:["2π/3","-π/3","π/3","-2π/3"], ans:"a"},
    {q:"Principal value csc⁻¹(-2)?", options:["-π/6","π/6","5π/6","-5π/6"], ans:"a"},
    {q:"Principal value sin⁻¹(1)?", options:["π/2","-π/2","0","π"], ans:"a"},
    {q:"Principal value cos⁻¹(-1)?", options:["π","0","π/2","-π/2"], ans:"a"},
    {q:"Principal value tan⁻¹(0)?", options:["0","π/2","π","-π/2"], ans:"a"},
    {q:"Principal value sin⁻¹(-1)?", options:["-π/2","π/2","0","-π"], ans:"a"},
    {q:"Principal value cos⁻¹(1)?", options:["0","π","π/2","-π/2"], ans:"a"}
  ]},

  // GK (password 1508) — SAME as your file
  "1508": { title:"Indian Freedom GK", questions:[
    {q:"First PM of India?", options:["Jawaharlal Nehru","Gandhi","Sardar Patel","Lal Bahadur"], ans:"a"},
    {q:"Year of Independence?", options:["1947","1950","1942","1930"], ans:"a"},
    {q:"Founder of INC?", options:["A.O.Hume","Tilak","Gokhale","Lajpat Rai"], ans:"a"},
    {q:"Leader of Salt March?", options:["Gandhi","Nehru","Azad","Tilak"], ans:"a"},
    {q:"First President of India?", options:["Rajendra Prasad","Nehru","Gandhi","Patel"], ans:"a"},
    {q:"Who gave Quit India call?", options:["Gandhi","Nehru","Azad","Lal Bahadur"], ans:"a"},
    {q:"Leader of 1857 revolt?", options:["Rani Laxmi Bai","Gandhi","Nehru","Tilak"], ans:"a"},
    {q:"Father of Indian Constitution?", options:["B.R.Ambedkar","Nehru","Patel","Gandhi"], ans:"a"},
    {q:"Freedom fighter from Bengal?", options:["Surya Sen","Tilak","Gandhi","Azad"], ans:"a"},
    {q:"Founder of Azad Hind Fauj?", options:["Subhash Chandra Bose","Nehru","Gandhi","Tilak"], ans:"a"},
    {q:"Popularized Swadeshi Movement?", options:["Bal Gangadhar Tilak","Gandhi","Nehru","Patel"], ans:"a"},
    {q:"Leader of Bardoli Satyagraha?", options:["Sardar Patel","Gandhi","Nehru","Azad"], ans:"a"},
    {q:"First woman president INC?", options:["Annie Besant","Sarojini Naidu","Vijaya Lakshmi","Indira Gandhi"], ans:"a"},
    {q:"Who wrote Young India?", options:["Gandhi","Tilak","Nehru","Patel"], ans:"a"},
    {q:"Freedom fighter Maharashtra?", options:["Tilak","Patel","Nehru","Gandhi"], ans:"a"},
    {q:"Leader Champaran Satyagraha?", options:["Gandhi","Tilak","Nehru","Azad"], ans:"a"},
    {q:"Launched Non-Cooperation Movement?", options:["Gandhi","Nehru","Azad","Tilak"], ans:"a"},
    {q:"Executed at Lahore?", options:["Bhagat Singh","Gandhi","Nehru","Patel"], ans:"a"},
    {q:"Leader Home Rule League?", options:["Tilak","Gandhi","Nehru","Patel"], ans:"a"},
    {q:"Presided over Lahore Congress 1929?", options:["Jawaharlal Nehru","Tilak","Gandhi","Azad"], ans:"a"}
  ]}
};

// ====== STATE ======
let selectedQuiz = null, studentName="", currentQ=0, score=0, answers=[], timerInterval=null, preStartInterval=null, questionList=[];

// ====== HELPERS ======
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

// ====== FLOW ======
function onPasswordEnter(){
  const pwd=document.getElementById("accessPwd").value.trim();
  if(BANK[pwd]){
    selectedQuiz=BANK[pwd];
    document.getElementById("passwordScreen").style.display="none";
    document.getElementById("nameScreen").style.display="block";
  } else if(pwd==="9110"){
    document.getElementById("passwordScreen").style.display="none";
    document.getElementById("adminScreen").style.display="block";
    loadAdmin();
  } else {
    alert("Invalid password");
  }
}

function startQuiz(){
  studentName=document.getElementById("studentName").value.trim();
  if(!studentName){ alert("Enter name"); return; }
  document.getElementById("nameScreen").style.display="none";
  document.getElementById("quizScreen").style.display="block";

  currentQ=0; score=0; answers=[]; questionList = shuffle(selectedQuiz.questions.slice()); // randomize question order

  // Time lock ONLY for Sets (150)
  if(selectedQuiz===BANK["150"]){
    handleSetsTiming();
  } else {
    showQuestion();
    hideOrShowNext(true);
    document.getElementById("timer").innerText=""; // no timer for other quizzes
  }
}

function hideOrShowNext(show){
  document.getElementById("nextBtn").style.display = show?"inline-block":"none";
}

function handleSetsTiming(){
  // Before start — show countdown and hide question/next
  const now = new Date();
  if(now < SETS_START){
    document.getElementById("questionBox").innerHTML = "";
    hideOrShowNext(false);
    updatePreStartCountdown();
    preStartInterval = setInterval(updatePreStartCountdown, 1000);
  } else if(now >= SETS_START && now < SETS_END){
    // Window open — start showing questions and countdown to end
    showQuestion();
    hideOrShowNext(true);
    runCountdownToEnd();
  } else {
    // Already ended
    document.getElementById("timer").innerText = "Test ended";
    finishQuiz();
  }
}

function updatePreStartCountdown(){
  const now = new Date();
  const diff = SETS_START - now;
  if(diff <= 0){
    clearInterval(preStartInterval);
    showQuestion();
    hideOrShowNext(true);
    runCountdownToEnd();
    return;
  }
  const m = Math.floor(diff/1000/60);
  const s = Math.floor((diff/1000)%60);
  document.getElementById("timer").innerText = `Test not started yet — unlocks in ${m}m ${s}s`;
}

function runCountdownToEnd(){
  clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    const diff = SETS_END - new Date();
    if(diff <= 0){
      clearInterval(timerInterval);
      document.getElementById("timer").innerText = "Time's up!";
      finishQuiz(); // auto-submit at end time
    } else {
      const m=Math.floor(diff/1000/60);
      const s=Math.floor((diff/1000)%60);
      document.getElementById("timer").innerText = `Time left: ${m}m ${s}s`;
    }
  },1000);
}

function showQuestion(){
  if(currentQ>=questionList.length){ finishQuiz(); return; }
  const q = questionList[currentQ];
  const opts = shuffle(q.options.slice()); // randomize options each time
  let html = `<fieldset><legend>Q${currentQ+1}: ${q.q}</legend>`;
  opts.forEach(o=>{ html += `<label class="option"><input type="radio" name="opt" value="${o}">${o}</label>`; });
  html += `</fieldset>`;
  document.getElementById("questionBox").innerHTML = html;
}

function onNext(){
  const sel=document.querySelector('input[name="opt"]:checked');
  if(!sel){ alert("Select option"); return; }
  answers.push(sel.value);
  const q = questionList[currentQ];
  const correct = q.options[q.ans.charCodeAt(0)-97];
  if(sel.value===correct) score++;
  currentQ++; showQuestion();
}

function finishQuiz(){
  clearInterval(timerInterval); clearInterval(preStartInterval);
  document.getElementById("questionBox").style.display="none";
  hideOrShowNext(false);

  const qlist = questionList.length? questionList : (selectedQuiz? selectedQuiz.questions: []);
  let summary = "";
  for(let i=0;i<qlist.length;i++){
    const correct = qlist[i].options[qlist[i].ans.charCodeAt(0)-97];
    const yourAns = (i<answers.length)? answers[i] : "(no answer)";
    summary += `Q${i+1}: ${qlist[i].q}\nYour answer: ${yourAns} => ${yourAns===correct ? "Correct" : "Wrong"}\nCorrect: ${correct}\n\n`;
  }
  document.getElementById("studentInfo").innerText = `Name: ${studentName}\nQuiz: ${selectedQuiz? selectedQuiz.title: ''}`;
  document.getElementById("scoreInfo").innerText = `Score: ${score} / ${qlist.length}`;
  document.getElementById("summary").innerText = summary;
  document.getElementById("resultCard").style.display = "block";
  saveToSheet();
}

function printResult(){ window.print(); }

// ====== STORAGE / ADMIN ======
function saveToSheet(){
  const date=new Date().toLocaleString();
  const quizTitle = selectedQuiz? selectedQuiz.title : "";
  const data={Name:studentName,Quiz:quizTitle,Score:score,Date:date};
  let stored=JSON.parse(localStorage.getItem("quizResults")||"[]"); stored.push(data);
  localStorage.setItem("quizResults",JSON.stringify(stored));
  // Send to Google Sheet
  fetch(SERVER_WEBAPP_URL+"?"+
        "name="+encodeURIComponent(studentName)+
        "&quiz="+encodeURIComponent(quizTitle)+
        "&score="+encodeURIComponent(score)+
        "&date="+encodeURIComponent(date))
    .then(()=>console.log("Saved to sheet"))
    .catch(e=>console.log("Sheet save failed",e));
}

function loadAdmin(){
  document.getElementById("openSheetBtn").href=GOOGLE_SHEET_URL;
  let stored=JSON.parse(localStorage.getItem("quizResults")||"[]");
  let tbody=""; stored.forEach(r=>{ tbody += `<tr><td>${r.Name}</td><td>${r.Quiz}</td><td>${r.Score}</td><td>${r.Date}</td></tr>`; });
  document.getElementById("adminTable").innerHTML = tbody;
}

function downloadLocalCSV(){
  let stored=JSON.parse(localStorage.getItem("quizResults")||"[]");
  if(!stored.length){ alert("No data"); return; }
  let csv="Name,Quiz,Score,Date\n";
  stored.forEach(r=>{ csv += `${r.Name},${r.Quiz},${r.Score},${r.Date}\n`; });
  let a=document.createElement("a"); a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(csv); a.download="quiz_results.csv"; a.click();
}

function clearLocalResults(){ if(confirm("Clear local data?")){ localStorage.removeItem("quizResults"); loadAdmin(); } }
</script>
</body>
</html>
