<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Combined Quizzes — The University Of Mathematics</title>
<style>
  body { font-family: Arial, sans-serif; background:#fffbe6; margin:0; padding:18px; }
  .wrap { max-width:1000px; margin:0 auto; }
  h1 { text-align:center; margin-bottom:6px; }
  fieldset { background:#fff; border:1px solid #ccc; padding:12px; border-radius:8px; margin-bottom:12px; }
  legend { font-weight:700; }
  input[type=text], input[type=password] { padding:8px; width:60%; max-width:360px; }
  button { padding:8px 12px; margin-left:6px; background:#f0c040; border:none; border-radius:6px; cursor:pointer; }
  #timer { font-size:18px; color:#b71c1c; font-weight:700; text-align:center; margin-bottom:8px; }
  .option { display:block; margin:8px 0; }
  #resultCard { background:#fff; border:2px solid #ccc; padding:12px; border-radius:8px; margin-top:12px; }
  .answer-summary { font-family:monospace; white-space:pre-wrap; text-align:left; margin-top:10px; }
  .correct { color:#117a37; font-weight:700; }
  .wrong { color:#c62828; font-weight:700; }
  table { width:100%; border-collapse:collapse; margin-top:12px; background:#fff; }
  th, td { border:1px solid #aaa; padding:8px; text-align:center; }
  .controls { text-align:center; margin-top:10px; }
  .small { font-size:13px; color:#444; }
  a.link-button { display:inline-block; padding:8px 12px; background:#7fb3ff; color:#000; border-radius:6px; text-decoration:none; margin-left:6px; }
</style>
</head>
<body>
<div class="wrap">
  <h1>The University Of Mathematics (Maths by Vikram Sir)</h1>

  <!-- Password screen -->
  <div id="passwordScreen">
    <fieldset>
      <legend>Access</legend>
      <input id="accessPwd" type="password" placeholder="Enter password">
      <button onclick="onPasswordEnter()">Enter</button>
    </fieldset>
  </div>

  <!-- Name input -->
  <div id="nameScreen" style="display:none;">
    <fieldset>
      <legend>Student Details</legend>
      <label class="small">Name: <input id="studentName" type="text" placeholder="Enter your name"></label>
      <button onclick="startQuiz()">Start Test</button>
    </fieldset>
  </div>

  <!-- Quiz -->
  <div id="quizScreen" style="display:none;">
    <div id="timer"></div>
    <div id="questionBox"></div>
    <div class="controls">
      <button id="nextBtn" onclick="onNext()">Next</button>
    </div>
    <div id="resultCard" style="display:none;">
      <h2>Test Result</h2>
      <p id="studentInfo" class="small"></p>
      <p id="scoreInfo" class="small"></p>
      <div id="summary" class="answer-summary"></div>
      <div class="controls">
        <button onclick="printResult()">Print Result</button>
      </div>
    </div>
  </div>

  <!-- Admin -->
  <div id="adminScreen" style="display:none;">
    <fieldset>
      <legend>Admin — Stored Results (local)</legend>
      <table>
        <thead><tr><th>Name</th><th>Quiz Code</th><th>Score</th><th>Date</th></tr></thead>
        <tbody id="adminTable"></tbody>
      </table>
      <div class="controls" style="margin-top:10px;">
        <button onclick="downloadLocalCSV()">Download Local CSV</button>
        <button onclick="clearLocalResults()">Clear Local Results</button>
        <a id="openSheetBtn" class="link-button" target="_blank" href="#">Open Google Sheet</a>
      </div>
    </fieldset>
  </div>
</div>

<script>
const SERVER_WEBAPP_URL = "https://script.google.com/macros/s/AKfycby0TOM4NqTTIJnLi_kh1gPY6VStck66t4MpLYLqM5XcyGe_n7ZwCDr7jxScDC4eoh2-/exec";
const GOOGLE_SHEET_URL = "https://docs.google.com/spreadsheets/d/1q073kqP1dLG2Lqbyu4dBNwtYCzq61mVHsl5B37npT6Y/edit?usp=sharing";

const BANK = {
  "100": { title:"Straight Line (Class 11)", questions:[
    {q:"Slope of 2x-3y+5=0?", options:["2/3","3/2","-2/3","-3/2"], ans:"c"},
    {q:"Equation of x-axis?", options:["x=0","y=0","y=x","x+y=0"], ans:"b"},
    {q:"Line through (0,0)&(2,3) slope?", options:["3/2","2/3","-3/2","-2/3"], ans:"a"},
    {q:"Slope perpendicular to y=-2x+5?", options:["1/2","2","-1/2","-2"], ans:"a"},
    {q:"Point (a,0) lies on?", options:["x-axis","y-axis","y=x","y=-x"], ans:"a"},
    {q:"Distance (3,4) to (0,0)?", options:["5","7","4","3"], ans:"a"},
    {q:"Equation y-2=0 represents?", options:["x-axis","y-axis","Horizontal","Vertical"], ans:"c"},
    {q:"Line with slope m through (x1,y1)?", options:["y-y1=m(x-x1)","y=mx+c","x/x1 + y/y1=1","None"], ans:"a"},
    {q:"Slope of vertical line?", options:["0","∞","1","-1"], ans:"b"},
    {q:"Intercepts of 3x+2y=6?", options:["(2,0)&(0,3)","(0,2)&(3,0)","(0,3)&(2,0)","(0,0)&(3,2)"], ans:"c"},
    {q:"Midpoint of (1,2)&(3,4)?", options:["(2,3)","(1,1)","(2,2)","(3,2)"], ans:"a"},
    {q:"Line through (1,2) slope 3?", options:["y=3x-1","y=3x+2","y=2x+3","y=-3x+5"], ans:"b"},
    {q:"Line parallel y=2x+5 slope?", options:["2","1/2","-2","-1/2"], ans:"a"},
    {q:"Line perpendicular y=5x+1 passes (0,1)?", options:["y=-1/5 x+1","y=5x+1","y=-5x+1","y=1/5x+1"], ans:"a"},
    {q:"Distance (1,1) to line x+y-3=0?", options:["1","√2","3","2"], ans:"b"},
    {q:"Equation bisector of x & y axes?", options:["y=x","y=-x","x+y=1","x-y=0"], ans:"a"},
    {q:"Line with intercepts (2,0)&(0,3) equation?", options:["x/2+y/3=1","y=2x+3","x+y=5","y=-2x+3"], ans:"a"},
    {q:"Distance between y=2x+1 & y=2x-3?", options:["2","3","4","5"], ans:"b"},
    {q:"Slope-intercept 3x-4y+12=0?", options:["3/4","-3/4","4/3","-4/3"], ans:"b"},
    {q:"y=mx+c through (2,3)&(4,7) m?", options:["1","2","3","4"], ans:"b"}
  ]},
  "200": { title:"Inverse Trigonometry (Class 12)", questions:[
    {q:"Principal value sin⁻¹(√3/2)?", options:["π/3","2π/3","π/6","-π/3"], ans:"a"},
    {q:"Principal value cos⁻¹(1/2)?", options:["π/3","2π/3","π/6","-π/3"], ans:"a"},
    {q:"Principal value tan⁻¹(1)?", options:["π/4","3π/4","-π/4","π/2"], ans:"a"},
    {q:"Principal value cot⁻¹(1)?", options:["π/4","3π/4","π/2","-π/4"], ans:"a"},
    {q:"Principal value sec⁻¹(2)?", options:["π/3","2π/3","π/6","-π/3"], ans:"a"},
    {q:"Principal value csc⁻¹(2)?", options:["π/6","5π/6","π/3","-π/6"], ans:"a"},
    {q:"Principal value sin⁻¹(-1/2)?", options:["-π/6","π/6","5π/6","-5π/6"], ans:"a"},
    {q:"Principal value cos⁻¹(-1/2)?", options:["2π/3","4π/3","π/3","-π/3"], ans:"a"},
    {q:"Principal value tan⁻¹(-1)?", options:["-π/4","3π/4","π/4","-3π/4"], ans:"a"},
    {q:"Principal value sin⁻¹(0)?", options:["0","π/2","π","-π/2"], ans:"a"},
    {q:"Principal value cos⁻¹(0)?", options:["π/2","0","π","-π/2"], ans:"a"},
    {q:"Principal value tan⁻¹(√3)?", options:["π/3","π/6","2π/3","-π/3"], ans:"a"},
    {q:"Principal value cot⁻¹(√3)?", options:["π/6","π/3","5π/6","-π/6"], ans:"a"},
    {q:"Principal value sec⁻¹(-2)?", options:["2π/3","-π/3","π/3","-2π/3"], ans:"a"},
    {q:"Principal value csc⁻¹(-2)?", options:["-π/6","π/6","5π/6","-5π/6"], ans:"a"},
    {q:"Principal value sin⁻¹(1)?", options:["π/2","-π/2","0","π"], ans:"a"},
    {q:"Principal value cos⁻¹(-1)?", options:["π","0","π/2","-π/2"], ans:"a"},
    {q:"Principal value tan⁻¹(0)?", options:["0","π/2","π","-π/2"], ans:"a"},
    {q:"Principal value sin⁻¹(-1)?", options:["-π/2","π/2","0","-π"], ans:"a"},
    {q:"Principal value cos⁻¹(1)?", options:["0","π","π/2","-π/2"], ans:"a"}
  ]},
  "1508": { title:"Indian Freedom GK", questions:[
    {q:"First PM of India?", options:["Jawaharlal Nehru","Gandhi","Sardar Patel","Lal Bahadur"], ans:"a"},
    {q:"Year of Independence?", options:["1947","1950","1942","1930"], ans:"a"},
    {q:"Founder of INC?", options:["A.O.Hume","Tilak","Gokhale","Lajpat Rai"], ans:"a"},
    {q:"Leader of Salt March?", options:["Gandhi","Nehru","Azad","Tilak"], ans:"a"},
    {q:"First President of India?", options:["Rajendra Prasad","Nehru","Gandhi","Patel"], ans:"a"},
    {q:"Who gave Quit India call?", options:["Gandhi","Nehru","Azad","Lal Bahadur"], ans:"a"},
    {q:"Leader of 1857 revolt?", options:["Rani Laxmi Bai","Gandhi","Nehru","Tilak"], ans:"a"},
    {q:"Father of Indian Constitution?", options:["B.R.Ambedkar","Nehru","Patel","Gandhi"], ans:"a"},
    {q:"Freedom fighter from Bengal?", options:["Surya Sen","Tilak","Gandhi","Azad"], ans:"a"},
    {q:"Founder of Azad Hind Fauj?", options:["Subhash Chandra Bose","Nehru","Gandhi","Tilak"], ans:"a"},
    {q:"Popularized Swadeshi Movement?", options:["Bal Gangadhar Tilak","Gandhi","Nehru","Patel"], ans:"a"},
    {q:"Leader of Bardoli Satyagraha?", options:["Sardar Patel","Gandhi","Nehru","Azad"], ans:"a"},
    {q:"First woman president INC?", options:["Annie Besant","Sarojini Naidu","Vijaya Lakshmi","Indira Gandhi"], ans:"a"},
    {q:"Who wrote Young India?", options:["Gandhi","Tilak","Nehru","Patel"], ans:"a"},
    {q:"Freedom fighter Maharashtra?", options:["Tilak","Patel","Nehru","Gandhi"], ans:"a"},
    {q:"Leader Champaran Satyagraha?", options:["Gandhi","Tilak","Nehru","Azad"], ans:"a"},
    {q:"Launched Non-Cooperation Movement?", options:["Gandhi","Nehru","Azad","Tilak"], ans:"a"},
    {q:"Executed at Lahore?", options:["Bhagat Singh","Gandhi","Nehru","Patel"], ans:"a"},
    {q:"Leader Home Rule League?", options:["Tilak","Gandhi","Nehru","Patel"], ans:"a"},
    {q:"Presided over Lahore Congress 1929?", options:["Jawaharlal Nehru","Tilak","Gandhi","Azad"], ans:"a"}
  ]},
  "300": { title:"Integration by Substitution", questions:[
    {q:"∫2x cos(x²) dx=?", options:["sin(x²)+C","-sin(x²)+C","cos(x²)+C","-cos(x²)+C"], ans:"a"},
    {q:"∫ dx/(x ln x)?", options:["ln|ln x|+C","1/ln x +C","ln|x|+C","x ln x+C"], ans:"a"},
    {q:"∫ x e^(x²) dx?", options:["1/2 e^(x²)+C","e^(x²)+C","ln(e^(x²))+C","1/x e^(x²)+C"], ans:"a"},
    {q:"∫ 1/(1+x²) dx?", options:["arctan x +C","arcsin x +C","arccos x +C","ln x +C"], ans:"a"},
    {q:"∫ sin(3x) dx?", options:["-1/3 cos3x+C","1/3 cos3x+C","1/3 sin3x+C","-1/3 sin3x+C"], ans:"a"},
    {q:"∫ cos(5x) dx?", options:["1/5 sin5x+C","-1/5 sin5x+C","cos5x+C","-cos5x+C"], ans:"a"},
    {q:"∫ 3x² dx?", options:["x³+C","3x²+C","x³/3+C","3x+C"], ans:"a"},
    {q:"∫ e^(2x) dx?", options:["1/2 e^(2x)+C","e^(2x)+C","2 e^(2x)+C","ln e^(2x)+C"], ans:"a"},
    {q:"∫ dx/√x?", options:["2√x+C","√x+C","1/√x +C","ln x +C"], ans:"a"},
    {q:"∫ dx/(x√(ln x))?", options:["2√ln x +C","√ln x+C","1/√ln x +C","ln ln x+C"], ans:"a"},
    {q:"∫ tan x dx?", options:["-ln|cosx|+C","ln|cosx|+C","ln|sinx|+C","-ln|sinx|+C"], ans:"a"},
    {q:"∫ cot x dx?", options:["ln|sinx|+C","-ln|sinx|+C","ln|cosx|+C","-ln|cosx|+C"], ans:"a"},
    {q:"∫ sec² x dx?", options:["tan x +C","cot x +C","sec x +C","csc x +C"], ans:"a"},
    {q:"∫ csc² x dx?", options:["-cot x +C","tan x +C","csc x +C","sec x +C"], ans:"a"},
    {q:"∫ dx/(x²+1)?", options:["arctan x +C","arcsin x +C","arccos x +C","ln x +C"], ans:"a"},
    {q:"∫ e^(x²) * 2x dx?", options:["e^(x²)+C","1/2 e^(x²)+C","ln e^(x²)+C","2 e^(x²)+C"], ans:"a"},
    {q:"∫ sin²x dx?", options:["x/2 - sin2x/4 +C","x/2 + sin2x/4 +C","-x/2 + sin2x/4 +C","x+ C"], ans:"a"},
    {q:"∫ cos²x dx?", options:["x/2 + sin2x/4 +C","x/2 - sin2x/4 +C","-x/2 + sin2x/4 +C","x+ C"], ans:"a"},
    {q:"∫ dx/√(1−x²)?", options:["arcsin x +C","arccos x +C","arctan x +C","ln x +C"], ans:"a"},
    {q:"∫ dx/(1−x²)?", options:["1/2 ln|(1+x)/(1−x)| +C","ln|(1+x)/(1−x)| +C","arctan x +C","arcsin x +C"], ans:"a"}
  ]}
};

let selectedQuiz = null, studentName="", currentQ=0, score=0, answers=[], timerInterval;

function shuffle(a){for(let i=a.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
function onPasswordEnter(){
  const pwd=document.getElementById("accessPwd").value;
  if(pwd==="100" || pwd==="200" || pwd==="1508" || pwd==="300"){
    selectedQuiz=BANK[pwd]; document.getElementById("passwordScreen").style.display="none";
    document.getElementById("nameScreen").style.display="block";
  } else if(pwd==="9110"){document.getElementById("passwordScreen").style.display="none";
    document.getElementById("adminScreen").style.display="block"; loadAdmin();}
  else{alert("Invalid password");}
}
function startQuiz(){
  studentName=document.getElementById("studentName").value.trim();
  if(!studentName){alert("Enter name"); return;}
  document.getElementById("nameScreen").style.display="none";
  document.getElementById("quizScreen").style.display="block";
  currentQ=0; score=0; answers=[]; showQuestion(); startTimer();
}
function showQuestion(){
  if(currentQ>=selectedQuiz.questions.length){finishQuiz(); return;}
  let q=selectedQuiz.questions[currentQ];
  let opts=shuffle(q.options.slice());
  let html=`<fieldset><legend>Q${currentQ+1}: ${q.q}</legend>`;
  opts.forEach((o,i)=>{html+=`<label class="option"><input type="radio" name="opt" value="${o}">${o}</label>`;});
  html+="</fieldset>"; document.getElementById("questionBox").innerHTML=html;
}
function onNext(){
  let sel=document.querySelector('input[name="opt"]:checked');
  if(!sel){alert("Select option"); return;}
  answers.push(sel.value);
  let correct=selectedQuiz.questions[currentQ].options[selectedQuiz.questions[currentQ].ans.charCodeAt(0)-97];
  if(sel.value===correct) score++;
  currentQ++; showQuestion();
}
function finishQuiz(){
  clearInterval(timerInterval);
  document.getElementById("questionBox").style.display="none";
  document.getElementById("nextBtn").style.display="none";
  let summary="", qlist=selectedQuiz.questions;
  for(let i=0;i<qlist.length;i++){
    let correct=qlist[i].options[qlist[i].ans.charCodeAt(0)-97];
    summary+=`Q${i+1}: ${qlist[i].q}\nYour answer: ${answers[i]} => ${answers[i]===correct ? "Correct":"Wrong"}\nCorrect: ${correct}\n\n`;
  }
  document.getElementById("studentInfo").innerText=`Name: ${studentName}\nQuiz: ${selectedQuiz.title}`;
  document.getElementById("scoreInfo").innerText=`Score: ${score} / ${qlist.length}`;
  document.getElementById("summary").innerText=summary;
  document.getElementById("resultCard").style.display="block";
  saveToSheet();
}
function startTimer(){
  let total=600; //10 minutes
  timerInterval=setInterval(()=>{let m=Math.floor(total/60), s=total%60;
    document.getElementById("timer").innerText=`Time left: ${m}m ${s}s`; total--; if(total<0){clearInterval(timerInterval); finishQuiz();}},1000);
}
function printResult(){window.print();}

// Local storage admin
function saveToSheet(){
  const date=new Date().toLocaleString();
  let data={Name:studentName,QuizCode:selectedQuiz.title,Score:score,Date:date};
  let stored=JSON.parse(localStorage.getItem("quizResults")||"[]"); stored.push(data);
  localStorage.setItem("quizResults",JSON.stringify(stored));
  //Send to Google Sheet
  fetch(SERVER_WEBAPP_URL+"?name="+encodeURIComponent(studentName)+"&quiz="+encodeURIComponent(selectedQuiz.title)+"&score="+score+"&date="+encodeURIComponent(date))
  .then(r=>console.log("Saved to sheet")).catch(e=>console.log("Sheet save failed",e));
}

function loadAdmin(){
  document.getElementById("openSheetBtn").href=GOOGLE_SHEET_URL;
  let stored=JSON.parse(localStorage.getItem("quizResults")||"[]"); 
  let tbody=""; stored.forEach(r=>{tbody+=`<tr><td>${r.Name}</td><td>${r.QuizCode}</td><td>${r.Score}</td><td>${r.Date}</td></tr>`;});
  document.getElementById("adminTable").innerHTML=tbody;
}

function downloadLocalCSV(){
  let stored=JSON.parse(localStorage.getItem("quizResults")||"[]");
  if(!stored.length){alert("No data"); return;}
  let csv="Name,Quiz,Score,Date\n";
  stored.forEach(r=>{csv+=`${r.Name},${r.QuizCode},${r.Score},${r.Date}\n`;});
  let a=document.createElement("a"); a.href="data:text/csv;charset=utf-8,"+encodeURIComponent(csv); a.download="quiz_results.csv"; a.click();
}

function clearLocalResults(){if(confirm("Clear local data?")){localStorage.removeItem("quizResults"); loadAdmin();}}
</script>
</body>
</html>
